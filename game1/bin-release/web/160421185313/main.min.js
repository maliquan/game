var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createScene())},n.createScene=function(){var t=this;nest.core.startup({egretAppId:90102,version:2,debug:!0},function(){t.initGame()})},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},n.initGame=function(){Global.STAGE=this.stage,Global.STAGE_W=this.stage.stageWidth,Global.STAGE_H=this.stage.stageHeight,PopUpMag.LAYER_SCENE=new eui.UILayer,PopUpMag.LAYER_SCENE.name="sceneLayer",PopUpMag.LAYER_SCENE.touchEnabled=!1,PopUpMag.LAYER_SCENE.touchChildren=!0,this.addChild(PopUpMag.LAYER_SCENE),PopUpMag.LAYER_UI=new eui.UILayer,PopUpMag.LAYER_UI.name="uiLayer",PopUpMag.LAYER_UI.touchEnabled=!1,PopUpMag.LAYER_UI.touchChildren=!0,this.addChild(PopUpMag.LAYER_UI),PopUpMag.LAYER_POPUP=new eui.UILayer,PopUpMag.LAYER_POPUP.name="popUpLayer",PopUpMag.LAYER_POPUP.touchEnabled=!1,PopUpMag.LAYER_POPUP.touchChildren=!0,this.addChild(PopUpMag.LAYER_POPUP),DataMag.instance.init(),LangMag.instance.setData("language"),PopUpMag.ins().showWin(WinName.LOGIN,1,!1,null,PopUpMag.LAYER_SCENE)},n.recvMsg=function(t,e){switch(t){case LocalId.SOCKET_CONNECT_SUCCESS:Message.instance.remove(LocalId.SOCKET_CONNECT_SUCCESS,this),console.log("WebSocketOpen")}},e}(eui.UILayer);egret.registerClass(Main,"Main",["IMessage"]);var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var HashMap=function(){function t(){this.hashCode=0,this.hashCode=t.HASH_COUNT++}var e=(__define,t),i=e.prototype;return i.put=function(t,e){this[t]=e},i.get=function(t){return this[t]},i.remove=function(t){var e=this[t];return null!=e&&delete this[t],e},i.contains=function(t){return null!=this[t]},i.keys=function(){var t=Object.keys(this),e=t.indexOf("hashCode");return e>-1&&t.splice(e,1),t},i.clear=function(){for(var t=this.keys(),e=t.length,i=0;e>i;i++)this.remove(t[i])},t.HASH_COUNT=0,t}();egret.registerClass(HashMap,"HashMap");var Message=function(){function t(){this.msgMap=new HashMap}var e=__define,i=t,n=i.prototype;return e(t,"instance",function(){return this._instance||(this._instance=new t),this._instance}),n.add=function(t,e){var i=this.msgMap.get(t);i||(i=[],this.msgMap.put(t,i)),-1==i.indexOf(e)&&i.push(e)},n.remove=function(t,e){var i=this.msgMap.get(t);if(i)for(var n=i.length,s=0;n>s;s++)i[s]==e&&(i[s]=null)},n.localSend=function(t,e){void 0===e&&(e=null);var i=this.msgMap.get(t);if(i){for(var n=i.length,s=0;n>s;)i[s]?(i[s].recvMsg.call(i[s],t,e),s++):(i.splice(s,1),n--);0>=n&&this.msgMap.remove(t)}},n.httpSend=function(){},n.socketSend=function(){},t}();egret.registerClass(Message,"Message");var BaseBtn=function(t){function e(){t.call(this),this.touchChildren=!1,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.downHandler,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setLab=function(t){this.label.text=LangMag.instance.getText(t)},n.setBkg=function(t){this.bkg.texture=RES.getRes(t)},n.createChildren=function(){t.prototype.createChildren.call(this),GameUtils.setAnchor(this,.5,.5)},n.setClkFun=function(t,e){this.fun=t,this.thisObj=e},n.downHandler=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.downHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.clkHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.cancleHandler,this),this.scaleX=this.scaleY=1.2},n.clkHandler=function(t){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.downHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.clkHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.cancleHandler,this),this.scaleX=this.scaleY=1,this.fun&&this.fun.call(this.thisObj,t)},n.cancleHandler=function(t){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.downHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.clkHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.cancleHandler,this),this.scaleX=this.scaleY=1},n.clean=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.downHandler,this)},e}(eui.Component);egret.registerClass(BaseBtn,"BaseBtn");var ViewCtl=function(t){function e(){t.call(this),this.postion=5,this.showData={},this.addEventListener(eui.UIEvent.COMPLETE,this.onLoadComplete,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this)},n.onLoadComplete=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.onLoadComplete,this)},n.close=function(){this.parent&&this.parent.removeChild(this)},n.show=function(){switch(this.postion){case 1:this.left=0,this.top=0;break;case 2:this.top=0,this.horizontalCenter=0;break;case 3:this.right=0,this.top=0;break;case 4:this.left=0,this.verticalCenter=0;break;case 5:this.horizontalCenter=0,this.verticalCenter=0;break;case 6:this.right=0,this.verticalCenter=0;break;case 7:this.left=0,this.bottom=0;break;case 8:this.bottom=0,this.horizontalCenter=0;break;case 9:this.right=0,this.bottom=0}},e}(eui.Component);egret.registerClass(ViewCtl,"ViewCtl");var Global=function(){function t(){}var e=(__define,t);e.prototype;return t.GAME_W=640,t.GAME_H=960,t.STAGE_W=0,t.STAGE_H=0,t.BASE_URL="http://localhost:3004",t.COLOR_FORE=2236962,t.COLOR_BACK=14540253,t}();egret.registerClass(Global,"Global");var HttpId=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(HttpId,"HttpId");var LocalId=function(){function t(){}var e=(__define,t);e.prototype;return t.CHAPTER_OVER=0,t.SOCKET_CONNECT_SUCCESS=1,t}();egret.registerClass(LocalId,"LocalId");var SocketId=function(){function t(){}var e=(__define,t);e.prototype;return t.LOGIN=1e4,t}();egret.registerClass(SocketId,"SocketId");var UserInfo=function(){function t(){this.name="",this.foodNum=0,this.goldNum=0,this.diamondNum=0,this.curChapterId=1,this.chapterDataList=[],this.maxChapterId=1e3}var e=__define,i=t,n=i.prototype;return e(t,"ins",function(){return this._ins||(this._ins=new t),this._ins}),n.parserLoginInfo=function(t){this.name=t.name||this.name,this.foodNum=t.foodNum||this.foodNum,this.goldNum=t.goldNum||this.goldNum,this.diamondNum=t.diamondNum||this.diamondNum,this.maxChapterId=t.maxChapterId||this.maxChapterId,this.curChapterId=t.curChapterId||this.curChapterId,this.chapterDataList=t.chapterList||this.chapterDataList},t}();egret.registerClass(UserInfo,"UserInfo");var WinName=function(){function t(){}var e=(__define,t);e.prototype;return t.LOGIN="LoginCtl",t.TIP_DIALOG="TipDialog",t.LOGIN_DIALOG="LoginDialog",t.MAIN_SCENE="MainScene",t.CHAPTER_OVER="ChapterOver",t}();egret.registerClass(WinName,"WinName");var DataMag=function(){function t(){this.mainParser=new MainParser,this.dataMap=new HashMap}var e=__define,i=t,n=i.prototype;return e(t,"instance",function(){return this._instance||(this._instance=new t),this._instance}),n.init=function(){var t=RES.getRes("config");t&&(this.configData=t.data)},n.getData=function(t){var e=this.dataMap.get(t);if(e)return e;var i=this.mainParser.getParser(t);if(i&&this.configData){var n=this.configData[i.fileName+".txt"];n&&(e=1==i.saveType?this.parserToMap(n,i):2==i.saveType?this.parserToList(n,i):n,e&&this.dataMap.put(t,e))}return e},n.parserToMap=function(t,e){for(var i,n,s=new HashMap,a=t.split("\r\n"),r=a.length,o=1;r>o;o++)""!=a[o]&&(i=egret.getDefinitionByName(e.parserCls),n=new i,n.init(a[o].split("	")),s.put(n[e.dataKey],n));return s},n.parserToList=function(t,e){for(var i,n,s=[],a=t.split("\r\n"),r=a.length,o=1;r>o;o++)""!=a[o]&&(i=egret.getDefinitionByName(e.parserCls),n=new i,n.init(a[o].split("	")),s.push(n));return s},t}();egret.registerClass(DataMag,"DataMag");var EnterFrameMag=function(){function t(){this.enterList=[],Global.STAGE.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)}var e=__define,i=t,n=i.prototype;return e(t,"instance",function(){return this._instance||(this._instance=new t),this._instance}),n.add=function(t,e){this.enterList.push(new EnterFrameEntity(t,e))},n.remove=function(t){for(var e=this.enterList,i=e.length,n=0;i>n;n++)e[n].thisObject==t&&(e[n].isRemove=!0)},n.has=function(t){for(var e=this.enterList,i=e.length,n=0;i>n;n++)if(e[n].thisObject==t)return!0;return!1},n.enterFrameHandler=function(t){for(var e=this.enterList,i=e.length,n=0;i>n;n++){var s=e[n];s.isRemove?(this.removeTime(s,n),n--,i--):s.callBack.call(s.thisObject)}},n.removeTime=function(t,e){t.callBack=null,t.thisObject=null,this.enterList.splice(e,1)},t}();egret.registerClass(EnterFrameMag,"EnterFrameMag");var LangMag=function(){function t(){}var e=__define,i=t,n=i.prototype;return e(t,"instance",function(){return this._instance||(this._instance=new t),this._instance}),n.setData=function(t){this.langData=RES.getRes(t)},n.getText=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.langData[t];if(n){var s=e.length;if(s>0)for(var a=1;s>=a;)n=n.replace("#v"+a+"#",e[a-1]+""),a++;return n}return""},t}();egret.registerClass(LangMag,"LangMag");var LoadMag=function(){function t(){}var e=__define,i=t,n=i.prototype;return e(t,"instance",function(){return this._instance||(this._instance=new t),this._instance}),n.load=function(t,e,i,n){return void 0===n&&(n=!0),this.groupName=t,this.callBack=e,this.thisObject=i,RES.isGroupLoaded(this.groupName)?void this.loadCallBack():(RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupLoadError,this),n&&RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGroupProgress,this),void RES.loadGroup(this.groupName))},n.imageByURL=function(t,e){RES.getResByUrl(e,function(e){t.texture=e},this,"image")},n.addToGroup=function(t,e){for(var i=RES.configInstance,n=i.getRawGroupByName(t),s=e.length,a=0;s>a;a++)n.push(i.getRawResourceItem(e[a]))},n.loadCallBack=function(){this.thisObject&&this.callBack&&this.callBack.call(this.thisObject),this.groupName="",this.thisObject=null,this.callBack=null},n.onGroupComplete=function(t){t.groupName==this.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGroupProgress,this),this.loadCallBack())},n.onGroupProgress=function(t){t.groupName==this.groupName},n.onGroupLoadError=function(t){},t}();egret.registerClass(LoadMag,"LoadMag");var PopUpMag=function(){function t(){this.popUpMap={},this.bkgWinName="",this.curOpenWin=[]}var e=(__define,t),i=e.prototype;return t.ins=function(){return null==this._ins&&(this._ins=new t),this._ins},i.showWin=function(e,i,n,s,a){void 0===i&&(i=5),void 0===n&&(n=!1),void 0===s&&(s=null),void 0===a&&(a=t.LAYER_POPUP);var r=this.popUpMap[e];if(null==r){var o=egret.getDefinitionByName(e);this.popUpMap[e]=new o}r=this.popUpMap[e],r.postion=i,r.showData=s,r.name=e,this.curOpenWin.push(r.name),this.setbkg(n,r),r.show(),a.addChild(r)},i.setbkg=function(e,i){void 0===i&&(i=null),this.bkg||(this.bkg=new egret.Shape,this.bkg.graphics.beginFill(0,.6),this.bkg.graphics.drawRect(0,0,Global.STAGE_W,Global.STAGE_H),this.bkg.graphics.endFill(),t.LAYER_POPUP.addChildAt(this.bkg,0)),this.bkg.touchEnabled=e,this.bkg.visible=e,this.bkgWinName=i?i.name:""},i.remove=function(t){var e=this.curOpenWin.indexOf(t);if(-1!=e&&this.curOpenWin.splice(e,1),this.bkgWinName==t&&this.setbkg(!1),null!=this.popUpMap[t]){var i=this.popUpMap[t];i.close()}},i.removeAll=function(){this.setbkg(!1);for(var t=this.curOpenWin.length,e=0;t>e;e++){var i=this.popUpMap[this.curOpenWin[e]];this.remove(i.name),e--,t--}},t}();egret.registerClass(PopUpMag,"PopUpMag");var SoundMag=function(){function t(){this._isPlayBg=!0,this.isPlayEffect=!0,this.bgPosition=0}var e=__define,i=t,n=i.prototype;return e(t,"instance",function(){return this._instance||(this._instance=new t),this._instance}),e(n,"isPlayBg",function(){return this.isPlayBg},function(t){this._isPlayBg=t,this._isPlayBg?this.bgChannel=this.bgSound.play(this.bgPosition,0):this.stopBg()}),n.playBg=function(t){0!=this._isPlayBg&&(this.bgSound=RES.getRes(t),this.bgChannel=this.bgSound.play(0,0))},n.stopBg=function(){this.bgPosition=this.bgChannel.position,this.bgChannel.stop()},n.play=function(t,e,i,n,s){if(void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=null),void 0===s&&(s=null),0!=this.isPlayEffect){var a=RES.getRes(t),r=a.play(0,i);r.volume=e,r.addEventListener(egret.Event.SOUND_COMPLETE,function(t){n&&n.call(s)},this)}},t}();egret.registerClass(SoundMag,"SoundMag");var TimerMag=function(){function t(){this.timeList=[],this.minDelay=10,this.timer=new egret.Timer(this.minDelay),this.timer.addEventListener(egret.TimerEvent.TIMER,this.tickHandler,this),this.timer.start()}var e=__define,i=t,n=i.prototype;return e(t,"instance",function(){return this._instance||(this._instance=new t),this._instance}),n.add=function(t,e,i,n){void 0===i&&(i=1e3),void 0===n&&(n=Number.MAX_VALUE);var s=new TimeEntity(i,t,e,n);this.timeList.push(s)},n.remove=function(t){for(var e=this.timeList,i=e.length,n=0;i>n;n++)e[n].thisObject==t&&(e[n].isRemove=!0)},n.has=function(t){for(var e=this.timeList,i=e.length,n=0;i>n;n++)if(e[n].thisObject==t)return!0;return!1},n.tickHandler=function(t){var e=this.timeList.length;if(e>0)for(var i,n=this.timeList,s=0;e>s;s++)i=n[s],i.isRemove?(this.removeTime(i,s),s--,e--):(i.oldTime+=this.minDelay,i.oldTime==i.delay&&(i.oldTime=0,i.maxCount-=1,i.callBack.call(i.thisObject),i.maxCount<=0)&&(this.removeTime(i,s),s--,e--));return!1},n.removeTime=function(t,e){t.callBack=null,t.thisObject=null,this.timeList.splice(e,1)},t}();egret.registerClass(TimerMag,"TimerMag");var EnterFrameEntity=function(){function t(t,e){this.callBack=null,this.thisObject=null,this.isRemove=!1,this.callBack=t,this.thisObject=e}var e=(__define,t);e.prototype;return t}();egret.registerClass(EnterFrameEntity,"EnterFrameEntity");var ParserEntity=function(){function t(t,e,i,n){void 0===n&&(n=""),this.parserCls=t,this.fileName=e,this.saveType=i,this.dataKey=n}var e=(__define,t);e.prototype;return t}();egret.registerClass(ParserEntity,"ParserEntity");var TimeEntity=function(){function t(t,e,i,n){this.delay=0,this.oldTime=0,this.maxCount=0,this.callBack=null,this.thisObject=null,this.isRemove=!1,this.delay=t,this.callBack=e,this.thisObject=i,this.maxCount=n,this.oldTime=0}var e=(__define,t);e.prototype;return t}();egret.registerClass(TimeEntity,"TimeEntity");var MainParser=function(){function t(){this.parserMap=new HashMap,this.initParser()}var e=(__define,t),i=e.prototype;return i.getParser=function(t){return this.parserMap.get(t)},i.initParser=function(){this.parserMap.put("item",new ParserEntity("game.ItemEntity","item",1,"id")),this.parserMap.put("propshop",new ParserEntity("game.PropShopEntity","propshop",2))},t}();egret.registerClass(MainParser,"MainParser");var HttpMsg=function(){function t(){this.reqsList=null,this.reqsId=0,this.isReqs=!1,this.sTime=0,this.key="",this.reqsList=[0]}var e=__define,i=t,n=i.prototype;return e(t,"instance",function(){return this._instance||(this._instance=new t),this._instance}),n.send=function(t,e,i,n){var s=5*this.reqsList[0];this.reqsList[s+1]=t,this.reqsList[s+2]=e,this.reqsList[s+3]=i,this.reqsList[s+4]=n,this.reqsList[0]++,this.checkData()},n.checkData=function(){if(!this.isReqs&&this.reqsList[0]>0){this.reqsList[0]--;var t=this.reqsList.splice(1,4);this.sendData(t)}},n.sendData=function(t){function e(t){var e=t.target,i=e.data;console.log(i),o.isReqs=!1,i&&a&&a.call(r,JSON.parse(i+"")),o.checkData()}function i(t,e,i){console.log("net error"),o.isReqs=!1,o.checkData()}var n=t[0],s=t[1]||{},a=t[2],r=t[3];s.reqsId=++this.reqsId;var o=this;o.isReqs=!0;var h=Global.BASE_URL+n,l=new egret.URLLoader;l.dataFormat=egret.URLLoaderDataFormat.TEXT,l.addEventListener(egret.Event.COMPLETE,e,this),l.addEventListener(egret.IOErrorEvent.IO_ERROR,i,this);var c=new egret.URLRequest(h);c.method=egret.URLRequestMethod.POST,c.data=new egret.URLVariables(GameUtils.objectToUrlParam(s)),l.load(c)},e(n,"serverTime",function(){return this.sTime+Math.floor(egret.getTimer()/1e3)}),t}();egret.registerClass(HttpMsg,"HttpMsg");var HttpMsgCMD=function(){function t(){}var e=(__define,t);e.prototype;return t.LOGIN="/game/login",t.START_CHAPTER="/game/startChapter",t.CHAPTER_OVER="/game/chapterOver",t}();egret.registerClass(HttpMsgCMD,"HttpMsgCMD");var SocketMsg=function(){function t(){}var e=__define,i=t,n=i.prototype;return e(t,"instance",function(){return this._instance||(this._instance=new t),this._instance}),n.initSocket=function(){this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket.connect("localhost",8e3)},n.onSocketOpen=function(t){Message.instance.localSend(LocalId.SOCKET_CONNECT_SUCCESS,this.socket)},n.onSocketClose=function(t){console.log("WebSocketClose")},n.onSocketError=function(t){console.log("WebSocketError"),console.log(t)},n.sendData=function(t,e){var i=new egret.ByteArray;i.writeInt(t),i.writeUTF(JSON.stringify(e)),i.position=0,this.socket.writeBytes(i,0,i.bytesAvailable)},n.onReceiveMessage=function(t){var e=new egret.ByteArray;this.socket.readBytes(e);var i=e.readUTF(),n=e.readBoolean(),s=e.readInt();console.log("收到数据:"),console.log("readUTF : "+i),console.log("readBoolean : "+n.toString()),console.log("readInt : "+s.toString())},t}();egret.registerClass(SocketMsg,"SocketMsg");var SLoginVo=function(){function t(){}var e=(__define,t),i=e.prototype;return i.setData=function(){},i.parseData=function(t){},t}();egret.registerClass(SLoginVo,"SLoginVo");var GameUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.rectGridToPixel=function(t,e,i,n){var s=t*i,a=e*n;return new egret.Point(s,a)},t.rectPixelToGrid=function(t,e,i,n){var s=Math.floor(t/i),a=Math.floor(e/n);return new egret.Point(s,a)},t.getMoveData=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=8);var s,a,r,o,h,l,c=t.x-e.x,g=t.y-e.y;h=Math.sqrt(c*c+g*g),s=Math.atan2(g,c),0!=i&&(r=i*Math.cos(s),o=i*Math.sin(s)),a=180*s/Math.PI;var d=Math.round(a/(360/n));return 0>d&&(d=Math.abs(d+n)),new MoveDataEntity(h,d,l,i,r,o,a)},t.getAngle=function(t,e,i,n){var s=Math.atan2(e-n,t-i);return 180*s/Math.PI},t.getHtml=function(t,e,i,n,s){void 0===i&&(i=12),void 0===n&&(n=0),void 0===s&&(s=!1);var a=t;return s&&(a="<u>"+t+"</u>"),a="<font color='#"+e.toString(16)+"' size='"+i.toString()+"'>"+a+"</font>",n>0&&(a="<textformat leading='"+n.toString()+"'>"+a+"</textformat>"),a},t.convertTime=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=!0);var n=Math.floor(t/86400),s=86400*n,a=Math.floor((t-s)/3600),r=3600*a,o=Math.floor((t-s-r)/60),h=60*o,l=t-s-r-h,c="";return 0==e?(n>0&&(c+=n.toString()+LangMag.instance.getText("@Day")),a>0?c+=a.toString()+LangMag.instance.getText("@Hour"):n>0&&(c+="0"+LangMag.instance.getText("@Hour")),o>0?c+=o.toString()+LangMag.instance.getText("@Minute"):(n>0||a>0)&&(c+="0"+LangMag.instance.getText("@Minute")),l>0?c+=l.toString()+LangMag.instance.getText("@Second"):(n>0||a>0||o>0)&&(c+="0"+LangMag.instance.getText("@Second"))):1==e&&(a+=24*n,a>0?(10>a&&(c+="0"),c+=a.toString()+":"):i&&(c+="00:"),o>0?(10>o&&(c+="0"),c+=o.toString()+":"):c+="00:",l>0?(10>l&&(c+="0"),c+=l.toString()):c+="00"),c},t.replace=function(t,e,i){void 0===i&&(i="");for(var n;;){n=t.indexOf(e);{if(!(n>-1))break;t="\n"==e?t.replace(/\n/,i):t.replace(e,i)}}return t},t.replaceContent=function(t,e){var i=e.length;if(i>0)for(var n=1;i>=n;)t=t.replace("#v"+n+"#",e[n-1].toString()),n++;return t},t.replaceContents=function(t,e){for(var i,n,s=[],a=t.length,r=0,o=0;a>o;o++)for(n={text:t[o].text},t[o].hasOwnProperty("style")&&(n.style=t[o].style),s.push(n),i="#v"+(r+1).toString()+"#";n.text.indexOf(i)>-1;)n.text=n.text.replace(i,e[r].toString()),r++,i="#v"+(r+1).toString()+"#";return s},t.createTextField=function(t,e,i,n,s,a,r,o){void 0===t&&(t=""),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=16777215),void 0===s&&(s=26),void 0===a&&(a=!1),void 0===r&&(r=egret.HorizontalAlign.LEFT),void 0===o&&(o=!1);var h=new egret.TextField;return h.text=t,h.type=o?egret.TextFieldType.INPUT:egret.TextFieldType.DYNAMIC,h.touchEnabled=o,e&&(h.width=e),i&&(h.height=i),h.size=s,h.textAlign=r,h.textColor=n,h.bold=a,h},t.numberToString=function(t,e){void 0===e&&(e=1);var i;if(t=Math.floor(t*Math.pow(10,e))/Math.pow(10,e),i=t.toString(),-1==i.indexOf(".")){i+=".";for(var n=0;e>n;n++)i+="0"}return i},t.setAnchor=function(t,e,i){t.anchorOffsetX=t.width*e,t.anchorOffsetY=t.height*i,t.x+=t.width*e,t.y+=t.height*i},t.objectToUrlParam=function(t){var e="";for(var i in t){var n=t[i];e+=null!=n&&void 0!=n?n.constructor==Array||n.constructor==Object?encodeURIComponent(i)+"="+encodeURIComponent(JSON.stringify(n))+"&":encodeURIComponent(i)+"="+encodeURIComponent(n)+"&":encodeURIComponent(i)+"=&"}return e.length>0&&(e=e.substring(0,e.length-1)),e},t.getQzoneHead=function(t,e){return void 0===e&&(e="50"),t=t.substring(0,t.lastIndexOf("/")),t+"/"+e},t}();egret.registerClass(GameUtils,"GameUtils");var MoveDataEntity=function(){function t(t,e,i,n,s,a,r){this.distance=t,this.direction=e,this.scale=i,this.speed=n,this.speedX=s,this.speedY=a,this.angle=r}var e=(__define,t),i=e.prototype;return i.isMove=function(){return this.distance-=this.speed,this.distance>0?!0:!1},t}();egret.registerClass(MoveDataEntity,"MoveDataEntity");var TweenUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.moveTweenShow=function(e,i,n,s,a,r){var o=i,h=n;switch(e){case t.LEFT_TO_RIGHT:o=-s.width;break;case t.RIGHT_TO_LEFT:o=Global.STAGE_W;break;case t.BOTTOM_TO_TOP:h=Global.STAGE_H;break;case t.TOP_TO_BOTTOM:h=-s.height}o==i&&h==n&&a&&a.call(r),s.x=o,s.y=h;var l=o==i?0:60,c=h==n?0:60;egret.Tween.get(s).to({x:i+l,y:n+c},200).to({x:i-l/2,y:n-c/2},100).to({x:i,y:n},100).call(function(){a&&a.call(r)},this)},t.moveTweenHide=function(e,i,n,s,a){void 0===s&&(s=null),void 0===a&&(a=null);var r=n.x,o=n.y;switch(e){case t.LEFT_TO_RIGHT:r=Global.STAGE_W;break;case t.RIGHT_TO_LEFT:r=-n.width;break;case t.BOTTOM_TO_TOP:o=-n.height;break;case t.TOP_TO_BOTTOM:o=Global.STAGE_H}egret.Tween.get(n).to({x:r,y:o},200,egret.Ease.backIn).call(function(){s?s.call(a):PopUpMag.ins().remove(i)},this)},t.NONE=0,t.LEFT_TO_RIGHT=1,t.RIGHT_TO_LEFT=2,t.TOP_TO_BOTTOM=3,t.BOTTOM_TO_TOP=4,t}();egret.registerClass(TweenUtils,"TweenUtils");var Server=function(){function t(){}var e=(__define,t);e.prototype;return t.request=function(t,e){if(!this.localData){this.userName=e.userName;var i=egret.localStorage.getItem(this.userName);i?this.localData=JSON.parse(i):this.localData={name:this.userName,foodNum:100,goldNum:100,diamondNum:0,curChapterId:1,maxChapterId:UserInfo.ins.maxChapterId,chapterList:[]}}var n={};switch(t){case HttpMsgCMD.LOGIN:n={ret:0,name:this.localData.name,foodNum:this.localData.foodNum,goldNum:this.localData.goldNum,diamondNum:this.localData.diamondNum,curChapterId:this.localData.curChapterId,maxChapterId:UserInfo.ins.maxChapterId,chapterList:this.localData.chapterList};break;case HttpMsgCMD.START_CHAPTER:this.localData.foodNum-=1,n={ret:0,foodNum:this.localData.foodNum,goldNum:this.localData.goldNum};break;case HttpMsgCMD.CHAPTER_OVER:var s=e.isWin,a=e.chapterId;if(s){var r=e.starNum,o=this.localData.chapterList;o[a]?(r=Math.max(r,this.localData.chapterList[a].starNum),this.localData.chapterList[a].starNum=r):this.localData.chapterList[a]={id:a,starNum:r},a==this.localData.curChapterId&&(this.localData.curChapterId=Math.min(this.localData.curChapterId+1,this.localData.maxChapterId))}n={curChapterId:this.localData.curChapterId,crossChapterId:a}}return UserInfo.ins.parserLoginInfo(n),this.saveData(),n},t.clean=function(){egret.localStorage.clear()},t.saveData=function(){egret.localStorage.clear(),egret.localStorage.setItem(this.userName,JSON.stringify(this.localData)),console.log(JSON.stringify(this.localData))},t.userName="",t}();egret.registerClass(Server,"Server");var GBtn=function(t){function e(e,i){t.call(this),this.isTap=!1,this.clkFun=e,this.thisObj=i,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.beginHandler,this),this.textColor=Global.COLOR_FORE,this.background=!0,this.backgroundColor=Global.COLOR_BACK,this.border=!0,this.borderColor=Global.COLOR_FORE,this.textAlign=egret.HorizontalAlign.CENTER,this.verticalAlign=egret.VerticalAlign.MIDDLE,this.minWidth=80,this.minHeight=35}__extends(e,t);var i=(__define,e),n=i.prototype;return n.tapHandler=function(t){},n.beginHandler=function(t){this.isTap||(this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.beginHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.outSideHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.endHandler,this),this.isTap=!0,this.textColor=Global.COLOR_BACK,this.backgroundColor=Global.COLOR_FORE,this.borderColor=Global.COLOR_BACK)},n.endHandler=function(t){console.log("end"),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.outSideHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.endHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.beginHandler,this);var e=this;TimerMag.instance.add(function(){e.isTap=!1,e.textColor=Global.COLOR_FORE,e.backgroundColor=Global.COLOR_BACK,e.borderColor=Global.COLOR_FORE,e.clkFun&&e.clkFun.call(e.thisObj)},this,100,1)},n.outSideHandler=function(t){console.log("outside"),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.outSideHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.endHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.beginHandler,this),this.isTap=!1,this.textColor=Global.COLOR_FORE,this.backgroundColor=Global.COLOR_BACK,this.borderColor=Global.COLOR_FORE},n.clean=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.beginHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.outSideHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.endHandler,this)},e}(eui.Label);egret.registerClass(GBtn,"GBtn");var GLabel=function(t){function e(){t.call(this),this.textColor=Global.COLOR_FORE}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Label);egret.registerClass(GLabel,"GLabel");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var LoginCtl=function(t){function e(){t.call(this),this.showStr="";var e=new SayPanel;this.addChild(e),e.startSay(this.sayOverHandler,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.sayOverHandler=function(){var t=LangMag.instance.getText("loginTitile"),e=LangMag.instance.getText("loginContent"),i=LangMag.instance.getText("shi"),n=LangMag.instance.getText("fou");PopUpMag.ins().showWin(WinName.TIP_DIALOG,5,!0,[t,e,i,n,this.clkHandler,this])},n.clkHandler=function(t){this.showStr=t,this.startBlack(),PopUpMag.ins().remove(WinName.TIP_DIALOG)},n.startBlack=function(){var t=new egret.Shape;t.graphics.beginFill(0),t.graphics.drawCircle(0,0,1),t.graphics.endFill(),this.addChild(t);var e=this;t.x=.5*Global.STAGE_W,t.y=.5*Global.STAGE_H,t.alpha=0;var i=.6*Math.max(Global.STAGE_W,Global.STAGE_H);egret.Tween.get(t).to({scaleX:i,scaleY:i,alpha:1},1e3,egret.Ease.sineOut).call(function(){e.startWrite()},this)},n.startWrite=function(){this.writeCircleSp=new egret.Shape,this.writeCircleSp.graphics.beginFill(16777215),this.writeCircleSp.graphics.drawCircle(0,0,1),this.writeCircleSp.graphics.endFill(),this.addChild(this.writeCircleSp);var t=this;this.writeCircleSp.x=.5*Global.STAGE_W,this.writeCircleSp.y=.5*Global.STAGE_H,this.writeCircleSp.alpha=0;var e=.2*Math.max(Global.STAGE_W,Global.STAGE_H);egret.Tween.get(this.writeCircleSp).to({scaleX:e,scaleY:e,alpha:1},500,egret.Ease.sineIn).call(function(){var e=LangMag.instance.getText("loginTitle2"),i=t.showStr,n=LangMag.instance.getText("sure");PopUpMag.ins().showWin(WinName.LOGIN_DIALOG,5,!1,[e,i,n,t.regiestHandler,t])},this)},n.regiestHandler=function(t,e){HttpMsg.instance.send(HttpMsgCMD.LOGIN,{userName:t,password:e},this.loginSuccess,this)},n.loginSuccess=function(t){if(0==t.ret){console.log("login success"),PopUpMag.ins().remove(WinName.LOGIN_DIALOG);var e=this,i=.6*Math.max(Global.STAGE_W,Global.STAGE_H);egret.Tween.get(this.writeCircleSp).to({scaleX:i,scaleY:i,alpha:1},500,egret.Ease.sineIn).call(function(){e.removeChildren(),PopUpMag.ins().remove(WinName.LOGIN),PopUpMag.ins().showWin(WinName.MAIN_SCENE)},this)}else{var n=LangMag.instance.getText(t.ret);console.log(n)}},e}(ViewCtl);egret.registerClass(LoginCtl,"LoginCtl");var SayPanel=function(t){function e(){t.call(this),this.sayArr=[],this.sayLab=new GLabel,this.sayLab.width=.8*Global.STAGE_W,this.sayLab.height=.6*Global.STAGE_H,this.sayLab.x=.5*Global.STAGE_W-.5*this.sayLab.width,this.sayLab.y=.5*Global.STAGE_H-.5*this.sayLab.height,this.sayLab.textColor=Global.COLOR_FORE,this.addChild(this.sayLab),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapHandler,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.startSay=function(t,e){this.sayOverFun=t,this.sayOverThisObject=e;
var i=LangMag.instance.getText("loginSay");this.sayArr=i.split(""),this.sayArr.reverse(),TimerMag.instance.add(this.saying,this,100)},n.saying=function(){this.sayLab.scrollV=this.sayLab.numLines-10,this.sayArr.length>0?this.sayLab.text+=this.sayArr.pop():this.stopSay()},n.stopSay=function(){this.sayOverFun&&(TimerMag.instance.remove(this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.tapHandler,this),this.sayOverFun.call(this.sayOverThisObject),this.sayOverFun=null)},n.tapHandler=function(t){for(var e=0;10>e;e++)this.saying()},e}(egret.Sprite);egret.registerClass(SayPanel,"SayPanel");var MainScene=function(t){function e(){t.call(this),console.log("show main scene")}__extends(e,t);var i=(__define,e);i.prototype;return e}(ViewCtl);egret.registerClass(MainScene,"MainScene");var LoginDialog=function(t){function e(){t.call(this),this.width=350,this.height=265,this.bkgShape=new egret.Shape,this.bkgShape.graphics.lineStyle(2,Global.COLOR_FORE,.8),this.bkgShape.graphics.beginFill(Global.COLOR_BACK),this.bkgShape.graphics.drawRect(0,0,this.width,this.height),this.bkgShape.graphics.endFill(),this.bkgShape.y=15,this.addChild(this.bkgShape),this.titleLab=new GLabel,this.titleLab.bold=!0,this.titleLab.background=!0,this.titleLab.backgroundColor=Global.COLOR_BACK,this.titleLab.x=20,this.titleLab.y=0,this.addChild(this.titleLab),this.contentLab=new GLabel,this.contentLab.width=this.width-20,this.contentLab.x=10,this.contentLab.y=50,this.addChild(this.contentLab),this.btn1=new GBtn(this.yesHandler,this),this.btn1.x=.5*this.width-.5*this.btn1.width,this.btn1.y=this.height-40,this.addChild(this.btn1);var e=new egret.Sprite;this.addChild(e);var i=new eui.Label;i.textColor=Global.COLOR_FORE,i.text=LangMag.instance.getText("userName"),e.addChild(i),this.userNameLab=new eui.EditableText,this.userNameLab.maxChars=16,this.userNameLab.textColor=Global.COLOR_FORE,this.userNameLab.width=160,this.userNameLab.height=35,this.userNameLab.border=!0,this.userNameLab.borderColor=Global.COLOR_FORE,this.userNameLab.x=i.width+5,e.addChild(this.userNameLab),e.x=.5*this.width-.5*e.width,e.y=this.btn1.y-100;var n=new egret.Sprite;this.addChild(n);var s=new eui.Label;s.textColor=Global.COLOR_FORE,s.text=LangMag.instance.getText("password"),n.addChild(s),this.passwordLab=new eui.EditableText,this.passwordLab.maxChars=16,this.passwordLab.textColor=Global.COLOR_FORE,this.passwordLab.width=160,this.passwordLab.height=35,this.passwordLab.border=!0,this.passwordLab.borderColor=Global.COLOR_FORE,this.passwordLab.displayAsPassword=!0,this.passwordLab.x=s.width+5,n.addChild(this.passwordLab),n.x=.5*this.width-.5*n.width,n.y=this.btn1.y-50}__extends(e,t);var i=(__define,e),n=i.prototype;return n.yesHandler=function(){this.clean(),this.onComplete()},n.onComplete=function(){this.callFun&&this.callFun.call(this.thisObject,[this.userNameLab.text,this.passwordLab.text])},n.clean=function(){this.btn1.clean()},n.show=function(){t.prototype.show.call(this),this.titleLab.text=this.showData[0],this.contentLab.text=this.showData[1],this.btn1.text=this.showData[2],this.callFun=this.showData[3],this.thisObject=this.showData[4]},e}(ViewCtl);egret.registerClass(LoginDialog,"LoginDialog");var TipDialog=function(t){function e(){t.call(this),this.width=350,this.height=215,this.bkgShape=new egret.Shape,this.bkgShape.graphics.lineStyle(2,Global.COLOR_FORE,.8),this.bkgShape.graphics.beginFill(Global.COLOR_BACK),this.bkgShape.graphics.drawRect(0,0,this.width,this.height),this.bkgShape.graphics.endFill(),this.bkgShape.y=15,this.addChild(this.bkgShape),this.titleLab=new GLabel,this.titleLab.bold=!0,this.titleLab.background=!0,this.titleLab.backgroundColor=Global.COLOR_BACK,this.titleLab.x=20,this.titleLab.y=0,this.addChild(this.titleLab),this.contentLab=new GLabel,this.contentLab.width=this.width-20,this.contentLab.x=10,this.contentLab.y=50,this.addChild(this.contentLab),this.btn1=new GBtn(this.yesHandler,this),this.btn1.x=.25*this.width-.5*this.btn1.width,this.btn1.y=this.height-50,this.addChild(this.btn1),this.btn2=new GBtn(this.noHandler,this),this.btn2.x=.75*this.width-.5*this.btn2.width,this.btn2.y=this.height-50,this.addChild(this.btn2)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.yesHandler=function(){var t=LangMag.instance.getText("loginYes");this.clean(),this.onComplete(t)},n.noHandler=function(){var t=LangMag.instance.getText("loginNo");this.clean(),this.onComplete(t)},n.onComplete=function(t){this.callFun&&this.callFun.call(this.thisObject,t)},n.clean=function(){this.btn1.clean(),this.btn2.clean()},n.show=function(){t.prototype.show.call(this),this.titleLab.text=this.showData[0],this.contentLab.text=this.showData[1],this.btn1.text=this.showData[2],this.btn2.text=this.showData[3],this.callFun=this.showData[4],this.thisObject=this.showData[5]},e}(ViewCtl);egret.registerClass(TipDialog,"TipDialog");